<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>OAuth Example</title>
    <link rel="stylesheet" href="https://js.arcgis.com/4.33/esri/themes/light/main.css" />
    <script src="https://js.arcgis.com/4.33/"></script>
    <style>#viewDiv { height: 100vh; }</style>
  </head>
  <body>
    <div id="viewDiv"></div>
    <script type="text/javascript">
      require([
        "esri/identity/OAuthInfo",
        "esri/identity/IdentityManager",
        "esri/WebMap",
        "esri/views/MapView"
      ], function (OAuthInfo, IdentityManager, WebMap, MapView) {
        const info = new OAuthInfo({
            appId: "z3jBzGntE5heV9Xd", // من لوحة التحكم
            portalUrl: "https://www.arcgis.com", // أو ArcGIS Enterprise
            popup: true, // لو false هيستخدم redirect بدلاً من popup
            flowType: "auto" // "authorization-code" أو "implicit"
        });
        IdentityManager.registerOAuthInfos([info]);

        IdentityManager.checkSignInStatus(info.portalUrl + "/sharing").then(() => {
          loadMap();
        }).catch(() => {
          IdentityManager.getCredential(info.portalUrl + "/sharing").then(() => {
            loadMap();
          });
        });

        function loadMap() {
          const map = new WebMap({
            portalItem: {
              id: "ad0bb153e2ad45e39e78896aded04ef6"
            }
          });

          new MapView({
            container: "viewDiv",
            map: map
          });
        }
      });
    </script>
  </body>
</html>
